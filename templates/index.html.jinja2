<html>
<head>
    <style>
        #map {
            width: 800px;
            height: 600px;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
          integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
            integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/heatmap.js/2.0.0/heatmap.min.js"
            integrity="sha512-FpvmtV53P/z7yzv1TAIVH7PNz94EKXs5aV6ts/Zi+B/VeGU5Xwo6KIbwpTgKc0d4urD/BtkK50IC9785y68/AA=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-heatmap@1/leaflet-heatmap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
</head>

<body>
<nav class="navbar navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <img src="/docs/5.0/assets/brand/bootstrap-logo.svg" alt="" width="30" height="24"
                 class="d-inline-block align-text-top">
            Bootstrap
        </a>
    </div>
</nav>
<div class="container d-flex align-items-center justify-content-center mt-2">
    <div id="map"></div>
</div>
<script>
    let locations = [
        {% for location in locations %}
        {
            'lat': '{{ location.lat | string | safe }}',
            'lng': '{{ location.lon | string | safe }}',
            'occupancy': {{ location.occupancy }},
        },
        {% endfor %}
    ]

    let baseLayer = L.tileLayer(
        'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a>',
        }
    )
    let cfg = {
        "radius": 40,
        "useLocalExtrema": true,
        valueField: 'occupancy',
    };
    let heatmapLayer = new HeatmapOverlay(cfg);
    let min = Math.min(...locations.map(sale => sale.value))
    let max = Math.max(...locations.map(sale => sale.value))
    let propertyHeatMap = new L.Map('map', {
        center: new L.LatLng(25.650906355649028, -100.2896934916991),
        zoom: 20,
        layers: [baseLayer, heatmapLayer]
    })
    heatmapLayer.setData({
        min: min,
        max: max,
        data: locations
    });

    locations.forEach(({lat, lng, occupancy}) => {
        L.marker([lat, lng]).addTo(propertyHeatMap)
    })
</script>
</body>
</html>