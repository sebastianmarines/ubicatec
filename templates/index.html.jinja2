<html>
<head>
    <title>UbicaTec</title>
    <link rel="icon" href="https://gist.githubusercontent.com/sebastianmarines/3cb5aeee89e87c5986ff00db01b51922/raw/2febc52c9986c6373ef9e381451ff756d13cb36f/UBICATEC.svg" sizes="any" type="image/svg+xml">
    <style>
      #map {
        width: 800px;
        height: 600px;
      }
);
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
          integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
            integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/heatmap.js/2.0.0/heatmap.min.js"
            integrity="sha512-FpvmtV53P/z7yzv1TAIVH7PNz94EKXs5aV6ts/Zi+B/VeGU5Xwo6KIbwpTgKc0d4urD/BtkK50IC9785y68/AA=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-heatmap@1/leaflet-heatmap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
</head>

<body>

<!--  AQUI EMPIEZA EL TEMPLATE -->
<nav class="navbar navbar-expand-lg navbar-light bg-light static-top">
  <div class="container">
    <a class="navbar-brand" href="#">
      <img src="https://gist.githubusercontent.com/sebastianmarines/73340d2b97748e145b32d84179ee89fa/raw/0c4ef87a724a3f46d693b2548e2f3a5b2da41a43/UBICATECgde2.svg" alt="..." height="36">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#barraNavegadora" aria-controls="barraNavegadora" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="barraNavegadora">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <button type="button" class="btn btn-primary"
              data-bs-toggle="modal" data-bs-target="#indicadores">
              Indicators
          </button>
          <!--Bootstrap modal -->
          <div class="modal fade" id="indicadores" tabindex="-1"
              role="dialog" aria-labelledby="indicadoresLabel"
              aria-hidden="true">
              <div class="modal-dialog" role="document">
                  <div class="modal-content">
                      <!-- Modal heading -->
                      <div class="modal-header">
                          <h5 class="modal-title" id="indicadoresLabel">
                              Indicators
                          </h5>
                          <button type="button" class="close"
                              data-bs-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">
                                  ×
                              </span>
                          </button>
                      </div>
                      <!-- Modal body with image -->
                      <div class="modal-body">
                          <img src="gfg.png" />
                      </div>
                  </div>
              </div>
          </div>
        </li>
        <li class="nav-item">
          <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#about">
            About
          </button>
          <div class="modal fade" id="about" tabindex="-1" role="dialog" aria-labelledby="aboutTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLongTitle">About this project</h5>
                  <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  This project was made by students from Tecnológico de Monterrey
                  <br>
                  Developers:
                  <br>
                  Sebastian Marines, Paulina Covarrubias, Saúl Sánchez, Patricio Maya and Santiago Posada.
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
        </li>

      

      </ul>
    </div>
  </div>
</nav>

<!-- Page Content -->



<div class="container d-flex align-items-center justify-content-center mt-2">
    <div id="map"></div>
</div>
<script>
    let locations = [
        {% for location in locations %}
            {
                'lat': '{{ location.lat | string | safe }}',
                'lng': '{{ location.lon | string | safe }}',
                'occupancy': {{ location.occupancy }},
            },
        {% endfor %}
    ]

    let baseLayer = L.tileLayer(
        'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a>',
        }
    )
    let cfg = {
        "radius": 40,
        "useLocalExtrema": true,
        valueField: 'occupancy',
    };
    let heatmapLayer = new HeatmapOverlay(cfg);
    let min = Math.min(...locations.map(sale => sale.value))
    let max = Math.max(...locations.map(sale => sale.value))
    let propertyHeatMap = new L.Map('map', {
        center: new L.LatLng(25.650906355649028, -100.2896934916991),
        zoom: 20,
        layers: [baseLayer, heatmapLayer]
    })
    heatmapLayer.setData({
        min: min,
        max: max,
        data: locations
    });

    locations.forEach(({lat, lng, occupancy}) => {
        L.marker([lat, lng]).addTo(propertyHeatMap)
    })
</script>
</body>
</html>